---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - vite.config.ts
  - index.html
  - src/main.ts
  - src/style.css
  - src/vite-env.d.ts
  - public/draco/
  - public/models/
  - scripts/compress-glb.sh
  - scripts/generate-barbell.ts
autonomous: true
requirements:
  - TECH-03
  - TECH-04

must_haves:
  truths:
    - "Running npm run dev opens the app in a browser with no console errors"
    - "npm run build produces a dist/ folder with no build errors"
    - "At least one Draco-compressed GLB exists in public/models/ and is under 500KB"
    - "DRACOLoader can load the compressed GLB at runtime without decoder 404 errors"
  artifacts:
    - path: "package.json"
      provides: "Project manifest with all dependencies and scripts"
      contains: "three"
    - path: "vite.config.ts"
      provides: "Vite + Tailwind v4 configuration"
      contains: "@tailwindcss/vite"
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
    - path: "index.html"
      provides: "HTML entry point"
      contains: "src/main.ts"
    - path: "src/main.ts"
      provides: "Application entry point"
      min_lines: 5
    - path: "src/style.css"
      provides: "Tailwind v4 CSS with theme tokens"
      contains: "@import"
    - path: "public/draco/"
      provides: "Draco decoder WASM/JS files"
    - path: "public/models/"
      provides: "Compressed GLB assets"
    - path: "scripts/compress-glb.sh"
      provides: "GLB Draco compression script"
      contains: "gltf-transform"
  key_links:
    - from: "vite.config.ts"
      to: "@tailwindcss/vite"
      via: "Vite plugin"
      pattern: "tailwindcss"
    - from: "src/style.css"
      to: "tailwindcss"
      via: "CSS import"
      pattern: "@import.*tailwindcss"
    - from: "index.html"
      to: "src/main.ts"
      via: "script module"
      pattern: "src/main.ts"
---

<objective>
Scaffold the FormCheck project with Vite 7 + vanilla TypeScript + Three.js + Tailwind v4 + Zustand, and establish the Draco asset compression pipeline with a working compressed GLB.

Purpose: Creates the foundation every subsequent phase builds on. Without a working scaffold and asset pipeline, no 3D work can begin. TECH-04 requires Draco compression from day one to avoid retrofitting issues.
Output: A running Vite dev server, a passing production build, Draco decoder files in public/draco/, and at least one compressed GLB under 500KB in public/models/.
</objective>

<execution_context>
@C:/Users/kyles/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/kyles/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Vite project with all dependencies and configuration</name>
  <files>
    package.json
    tsconfig.json
    vite.config.ts
    index.html
    src/main.ts
    src/style.css
    src/vite-env.d.ts
  </files>
  <action>
Scaffold a new Vite vanilla-ts project in the repo root (D:/Forms) — since the repo already has .git and .planning, do NOT use `npm create vite` (it would create a subdirectory). Instead, manually create the project files:

1. Create `package.json` with:
   - name: "formcheck"
   - type: "module"
   - Scripts: dev, build, preview, prepare (Draco decoder copy)
   - Dependencies: three, zustand
   - DevDependencies: @types/three, typescript, vite, tailwindcss, @tailwindcss/vite, @gltf-transform/cli, @gltf-transform/core, @gltf-transform/functions

2. Create `tsconfig.json` with:
   - target: "ES2022", module: "ESNext", moduleResolution: "bundler"
   - strict: true, noEmit: true
   - Include: ["src"]

3. Create `vite.config.ts` with:
   - Import and register `@tailwindcss/vite` plugin
   - No other special config needed

4. Create `index.html` with:
   - Dark background via body class
   - A single div#app container
   - Script module pointing to /src/main.ts

5. Create `src/style.css` with:
   - `@import "tailwindcss";`
   - `@theme` block with custom tokens: --color-bg (dark), --color-surface (panel), --color-mannequin (light gray) using oklch values from research

6. Create `src/main.ts` with:
   - Import `./style.css`
   - A minimal "FormCheck loaded" console log and placeholder text in #app
   - This proves the build chain works end-to-end

7. Create `src/vite-env.d.ts` with Vite client types reference.

8. Run `npm install` to install all dependencies.

9. Add a `prepare` script in package.json that copies Draco decoder files from `node_modules/three/examples/jsm/libs/draco/` to `public/draco/`. Use a cross-platform Node.js one-liner (not shell cp). Run `npm run prepare` to execute it.

10. Verify: `npm run dev` starts without errors. Kill the dev server. `npm run build` produces `dist/` with no errors.

IMPORTANT: Use Zustand v5 API — `createStore` from `zustand/vanilla`, NOT `create`.
IMPORTANT: Tailwind v4 is CSS-first — NO tailwind.config.js file. Configuration goes in the @theme block in CSS.
IMPORTANT: Three.js addon imports use `three/addons/...` path (not `three/examples/jsm/...`).
  </action>
  <verify>
Run `npm run dev -- --host` briefly (kill after confirming it starts), then run `npm run build`. Verify:
- No TypeScript compilation errors
- No Vite build errors
- `dist/` folder exists with index.html and JS assets
- `public/draco/` contains draco_decoder.wasm and draco_wasm_wrapper.js
- `ls public/draco/` shows decoder files present
  </verify>
  <done>
`npm run dev` starts with zero console errors. `npm run build` produces a deployable dist/ folder. Tailwind classes work (verify with a test class on the placeholder). Draco decoder files exist in public/draco/.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Draco asset pipeline and generate compressed ghost barbell GLB</name>
  <files>
    scripts/compress-glb.sh
    scripts/generate-barbell.ts
    public/models/barbell.glb
  </files>
  <action>
Establish the Draco compression pipeline and produce the first compressed GLB to satisfy TECH-04 ("at least one Draco-compressed GLB in public/models/ under 500KB").

1. Create `scripts/compress-glb.sh`:
   - A shell script that takes input GLB path as argument
   - Runs `npx gltf-transform draco "$INPUT" "$OUTPUT" --method edgebreaker`
   - Output file replaces the original (or writes to same path)
   - Echo success message with file size

2. Create `scripts/generate-barbell.ts`:
   - A Node.js script (run with `npx tsx scripts/generate-barbell.ts`)
   - Uses Three.js to programmatically build a barbell from CylinderGeometry primitives:
     - Long center bar (thin cylinder, ~1.2m length, ~0.025m radius)
     - Two weight plates on each end (short wide cylinders, ~0.225m radius, ~0.025m thick)
     - Optional collars between bar and plates (slightly wider than bar)
   - Uses THREE.GLTFExporter (from `three/addons/exporters/GLTFExporter.js`) to export as GLB
   - Writes raw GLB to `public/models/barbell-raw.glb`
   - Note: GLTFExporter works in Node.js context when using the right imports

   If GLTFExporter has issues in Node.js, fall back to manually constructing a minimal GLB using @gltf-transform/core:
   - Create a Document with a single Scene
   - Add mesh primitives (cylinder-like) using @gltf-transform/core API
   - Write to GLB with `io.writeBinary(document)`
   - This approach is guaranteed to work in Node.js

3. Run the generation script to produce the raw GLB.

4. Run `bash scripts/compress-glb.sh public/models/barbell-raw.glb` to produce the Draco-compressed version. Move or rename the compressed output to `public/models/barbell.glb`. Delete the raw file if compression succeeded.

5. Verify the compressed file is under 500KB (it should be well under — simple geometry).

6. Add an `npm run compress-glb` script to package.json: `"compress-glb": "gltf-transform draco"`

IMPORTANT: Ghost equipment is meant to be barely visible (10-20% opacity wireframe). The material in the GLB should use a light color. The actual transparency/ghost rendering will be applied at load time in later phases.
IMPORTANT: The barbell must be programmatically generated — no external asset downloads (per user decision).
  </action>
  <verify>
- `ls -la public/models/barbell.glb` shows file exists and is under 500KB
- Run `npx gltf-transform inspect public/models/barbell.glb` to confirm Draco extension is present in the output
- File size check: `wc -c < public/models/barbell.glb` returns a number under 512000
  </verify>
  <done>
A Draco-compressed barbell.glb exists in public/models/ and is under 500KB. The compress-glb.sh script works for any GLB input. The generate-barbell script can be re-run to regenerate the asset. The full pipeline (generate -> compress -> verify) is documented and repeatable.
  </done>
</task>

</tasks>

<verification>
Phase-level checks for Plan 01:
1. `npm run dev` starts a dev server that loads in the browser with no console errors
2. `npm run build` produces dist/ folder with no errors
3. `ls public/draco/` shows draco_decoder.wasm and draco_wasm_wrapper.js
4. `ls public/models/barbell.glb` shows the compressed GLB file exists
5. File size of barbell.glb is under 500KB
6. `npx gltf-transform inspect public/models/barbell.glb` shows KHR_draco_mesh_compression extension
</verification>

<success_criteria>
- Vite dev server runs with zero errors
- Production build succeeds (dist/ folder created)
- Tailwind v4 CSS compiles (utility classes work)
- Draco decoder files present in public/draco/
- At least one Draco-compressed GLB under 500KB in public/models/
- All npm scripts functional: dev, build, preview, prepare, compress-glb
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
